# MongoDB Database Structure for Android App - MyClass Attendance System

## Overview

This document details the MongoDB database structure for the Android mobile application version of the MyClass Attendance System. Unlike the traditional relational approach, MongoDB's document-oriented structure provides flexibility and scalability for the attendance management system. The design incorporates both remote MongoDB collections and local caching for offline functionality.

## MongoDB Architecture

### Database Configuration
- **Database Name**: `attendance_system_db`
- **Collections**: 6 core collections representing the academic hierarchy and attendance data
- **Connection**: Secure connection using MongoDB Atlas or self-hosted instance
- **Security**: SSL/TLS encryption, authentication, and role-based access control

### Document Relationships Strategy

Since MongoDB is a NoSQL database, relationships will be handled through:
- **Referencing**: Using ObjectIds to link related documents
- **Embedding**: Storing related data within parent documents where appropriate
- **Aggregation Pipeline**: Complex queries across collections

## Collection Definitions

### 1. Academic Years Collection (`academic_years`)

**Purpose**: Stores academic year information for the system

**Document Structure**:
```json
{
  "_id": ObjectId,
  "yearName": "2024-2025",
  "isActive": true,
  "createdAt": ISODate,
  "updatedAt": ISODate
}
```

**Fields**:
- `_id`: MongoDB ObjectId (Primary Key, Auto-generated)
  - Unique identifier for each academic year
  - Automatically generated by MongoDB
- `yearName`: String
  - Text representation of the academic year (e.g., "2024-2025")
  - Required field, cannot be null
- `isActive`: Boolean
  - Indicates if the academic year is currently active
  - Default: true
- `createdAt`: ISODate
  - Timestamp of document creation
  - Automatically set by application
- `updatedAt`: ISODate
  - Timestamp of last document update
  - Automatically updated on modification

**Example Documents**:
```json
{
  "_id": ObjectId("65a1b2c3d4e5f6789abcdef01"),
  "yearName": "2023-2024",
  "isActive": false,
  "createdAt": ISODate("2023-08-01T00:00:00Z"),
  "updatedAt": ISODate("2024-08-01T12:00:00Z")
}

{
  "_id": ObjectId("65a1b2c3d4e5f6789abcdef02"),
  "yearName": "2024-2025",
  "isActive": true,
  "createdAt": ISODate("2024-08-01T00:00:00Z"),
  "updatedAt": ISODate("2024-08-01T12:00:00Z")
}
```

### 2. Semester Types Collection (`semester_types`)

**Purpose**: Defines different types of semesters (e.g., Odd Semester, Even Semester)

**Document Structure**:
```json
{
  "_id": ObjectId,
  "typeName": "Odd Semester",
  "description": "First semester of academic year",
  "createdAt": ISODate,
  "updatedAt": ISODate
}
```

**Fields**:
- `_id`: MongoDB ObjectId (Primary Key, Auto-generated)
  - Unique identifier for each semester type
  - Automatically generated by MongoDB
- `typeName`: String
  - Name of the semester type
  - Required field, cannot be null
- `description`: String
  - Optional description of the semester type
  - Default: null
- `createdAt`: ISODate
  - Timestamp of document creation
  - Automatically set by application
- `updatedAt`: ISODate
  - Timestamp of last document update
  - Automatically updated on modification

**Example Documents**:
```json
{
  "_id": ObjectId("65a1b2c3d4e5f6789abcdef03"),
  "typeName": "Odd Semester",
  "description": "First semester of academic year",
  "createdAt": ISODate("2023-08-01T00:00:00Z"),
  "updatedAt": ISODate("2023-08-01T12:00:00Z")
}

{
  "_id": ObjectId("65a1b2c3d4e5f6789abcdef04"),
  "typeName": "Even Semester",
  "description": "Second semester of academic year",
  "createdAt": ISODate("2023-08-01T00:00:00Z"),
  "updatedAt": ISODate("2023-08-01T12:00:00Z")
}
```

### 3. Semesters Collection (`semesters`)

**Purpose**: Stores individual semester records linked to their types

**Document Structure**:
```json
{
  "_id": ObjectId,
  "semNumber": 1,
  "semesterTypeId": ObjectId,
  "isActive": true,
  "createdAt": ISODate,
  "updatedAt": ISODate
}
```

**Fields**:
- `_id`: MongoDB ObjectId (Primary Key, Auto-generated)
  - Unique identifier for each semester
  - Automatically generated by MongoDB
- `semNumber`: Integer
  - Numeric identifier for the semester (e.g., 1, 2, 3, 4, 5, 6, 7, 8)
  - Required field, cannot be null
- `semesterTypeId`: ObjectId (Foreign Key Reference)
  - Links to the semester type this semester belongs to
  - Required field, references `semester_types._id`
- `isActive`: Boolean
  - Indicates if the semester is currently active
  - Default: true
- `createdAt`: ISODate
  - Timestamp of document creation
  - Automatically set by application
- `updatedAt`: ISODate
  - Timestamp of last document update
  - Automatically updated on modification

**Example Documents**:
```json
{
  "_id": ObjectId("65a1b2c3d4e5f6789abcdef05"),
  "semNumber": 1,
  "semesterTypeId": ObjectId("65a1b2c3d4e5f6789abcdef03"),
  "isActive": true,
  "createdAt": ISODate("2024-08-01T00:00:00Z"),
  "updatedAt": ISODate("2024-08-01T12:00:00Z")
}

{
  "_id": ObjectId("65a1b2c3d4e5f6789abcdef06"),
  "semNumber": 2,
  "semesterTypeId": ObjectId("65a1b2c3d4e5f6789abcdef04"),
  "isActive": true,
  "createdAt": ISODate("2024-08-01T00:00:00Z"),
  "updatedAt": ISODate("2024-08-01T12:00:00Z")
}
```

### 4. Subjects Collection (`subjects`)

**Purpose**: Contains subject information linked to semesters

**Document Structure**:
```json
{
  "_id": ObjectId,
  "subjectName": "Data Structures",
  "subjectCode": "CS201",
  "semesterId": ObjectId,
  "credits": 3,
  "createdAt": ISODate,
  "updatedAt": ISODate
}
```

**Fields**:
- `_id`: MongoDB ObjectId (Primary Key, Auto-generated)
  - Unique identifier for each subject
  - Automatically generated by MongoDB
- `subjectName`: String
  - Full name of the subject
  - Required field, cannot be null
- `subjectCode`: String
  - Short code identifying the subject
  - Required field, cannot be null
- `semesterId`: ObjectId (Foreign Key Reference)
  - Links to the semester this subject belongs to
  - Required field, references `semesters._id`
- `credits`: Integer
  - Number of credits for the subject
  - Default: 3
- `createdAt`: ISODate
  - Timestamp of document creation
  - Automatically set by application
- `updatedAt`: ISODate
  - Timestamp of last document update
  - Automatically updated on modification

**Example Documents**:
```json
{
  "_id": ObjectId("65a1b2c3d4e5f6789abcdef07"),
  "subjectName": "Data Structures",
  "subjectCode": "CS201",
  "semesterId": ObjectId("65a1b2c3d4e5f6789abcdef05"),
  "credits": 3,
  "createdAt": ISODate("2024-08-01T00:00:00Z"),
  "updatedAt": ISODate("2024-08-01T12:00:00Z")
}

{
  "_id": ObjectId("65a1b2c3d4e5f6789abcdef08"),
  "subjectName": "Database Management",
  "subjectCode": "CS202",
  "semesterId": ObjectId("65a1b2c3d4e5f6789abcdef05"),
  "credits": 4,
  "createdAt": ISODate("2024-08-01T00:00:00Z"),
  "updatedAt": ISODate("2024-08-01T12:00:00Z")
}
```

### 5. Staff Collection (`staff`)

**Purpose**: Stores staff credentials for authentication with enhanced security

**Document Structure**:
```json
{
  "_id": ObjectId,
  "staffId": "STAFF001",
  "name": "John Smith",
  "email": "john.smith@institution.edu",
  "password": "$2b$10$...",
  "role": "instructor",
  "isActive": true,
  "lastLogin": ISODate,
  "createdAt": ISODate,
  "updatedAt": ISODate
}
```

**Fields**:
- `_id`: MongoDB ObjectId (Primary Key, Auto-generated)
  - Unique identifier for each staff member
  - Automatically generated by MongoDB
- `staffId`: String
  - Unique identifier for staff authentication
  - Required field, cannot be null
  - Indexed for fast lookups
- `name`: String
  - Staff member's full name
  - Required field, cannot be null
- `email`: String
  - Staff member's email address
  - Required field, cannot be null
- `password`: String
  - BCrypt hashed password for security
  - Required field, cannot be null
  - Never exposed in API responses
- `role`: String
  - Role of the staff member (instructor, admin, etc.)
  - Default: "instructor"
- `isActive`: Boolean
  - Indicates if the staff account is active
  - Default: true
- `lastLogin`: ISODate
  - Timestamp of last successful login
  - Default: null
- `createdAt`: ISODate
  - Timestamp of document creation
  - Automatically set by application
- `updatedAt`: ISODate
  - Timestamp of last document update
  - Automatically updated on modification

**Example Documents**:
```json
{
  "_id": ObjectId("65a1b2c3d4e5f6789abcdef09"),
  "staffId": "STAFF001",
  "name": "John Smith",
  "email": "john.smith@institution.edu",
  "password": "$2b$10$...",
  "role": "instructor",
  "isActive": true,
  "lastLogin": ISODate("2024-10-10T14:30:00Z"),
  "createdAt": ISODate("2023-08-01T00:00:00Z"),
  "updatedAt": ISODate("2024-10-10T14:30:00Z")
}

{
  "_id": ObjectId("65a1b2c3d4e5f6789abcdef10"),
  "staffId": "STAFF002",
  "name": "Jane Doe",
  "email": "jane.doe@institution.edu",
  "password": "$2b$10$...",
  "role": "admin",
  "isActive": true,
  "lastLogin": ISODate("2024-10-11T09:15:00Z"),
  "createdAt": ISODate("2023-08-01T00:00:00Z"),
  "updatedAt": ISODate("2024-10-11T09:15:00Z")
}
```

### 6. Attendance Collection (`attendance`)

**Purpose**: Records attendance data for students with mobile-specific optimizations

**Document Structure**:
```json
{
  "_id": ObjectId,
  "regNo": "STU001",
  "studentName": "Alice Johnson",
  "status": "Present",
  "subjectId": ObjectId,
  "academicYearId": ObjectId,
  "dateMarked": NumberLong,
  "markedBy": ObjectId,
  "isSynced": true,
  "isOfflineCreated": false,
  "deviceInfo": {
    "deviceId": "device-uuid",
    "ipAddress": "192.168.1.100",
    "location": {
      "lat": 12.345678,
      "lng": 98.765432
    }
  },
  "createdAt": ISODate,
  "updatedAt": ISODate
}
```

**Fields**:
- `_id`: MongoDB ObjectId (Primary Key, Auto-generated)
  - Unique identifier for each attendance record
  - Automatically generated by MongoDB
- `regNo`: String
  - Student's registration number
  - Required field, cannot be null
- `studentName`: String
  - Full name of the student
  - Required field, cannot be null
- `status`: String
  - Attendance status (Present/Absent)
  - Required field, cannot be null
  - Valid values: "Present", "Absent"
- `subjectId`: ObjectId (Foreign Key Reference)
  - Links to the subject for which attendance is marked
  - Required field, references `subjects._id`
- `academicYearId`: ObjectId (Foreign Key Reference)
  - Links to the academic year
  - Required field, references `academic_years._id`
- `dateMarked`: NumberLong
  - Timestamp when attendance was marked (in milliseconds)
  - Required field, cannot be null
- `markedBy`: ObjectId (Foreign Key Reference)
  - Links to the staff member who marked the attendance
  - Required field, references `staff._id`
- `isSynced`: Boolean
  - Flag indicating if record has been synced to server
  - Default: true (for server-created records)
- `isOfflineCreated`: Boolean
  - Flag indicating if record was created offline
  - Default: false
  - Used for conflict resolution during sync
- `deviceInfo`: Embedded Document
  - Information about the device used to create the record
  - Optional field
- `deviceInfo.deviceId`: String
  - Unique identifier of the device
  - Optional field
- `deviceInfo.ipAddress`: String
  - IP address of the device
  - Optional field
- `deviceInfo.location`: Embedded Document
  - Geographic location where attendance was marked
  - Optional field
- `deviceInfo.location.lat`: Double
  - Latitude coordinate
  - Optional field
- `deviceInfo.location.lng`: Double
  - Longitude coordinate
  - Optional field
- `createdAt`: ISODate
  - Timestamp of document creation
  - Automatically set by application
- `updatedAt`: ISODate
  - Timestamp of last document update
  - Automatically updated on modification

**Example Documents**:
```json
{
  "_id": ObjectId("65a1b2c3d4e5f6789abcdef11"),
  "regNo": "STU001",
  "studentName": "Alice Johnson",
  "status": "Present",
  "subjectId": ObjectId("65a1b2c3d4e5f6789abcdef07"),
  "academicYearId": ObjectId("65a1b2c3d4e5f6789abcdef02"),
  "dateMarked": NumberLong(1704960000000),
  "markedBy": ObjectId("65a1b2c3d4e5f6789abcdef09"),
  "isSynced": true,
  "isOfflineCreated": false,
  "deviceInfo": {
    "deviceId": "android-device-uuid-123",
    "ipAddress": "192.168.1.100",
    "location": {
      "lat": 12.971599,
      "lng": 77.594563
    }
  },
  "createdAt": ISODate("2024-01-11T10:00:00Z"),
  "updatedAt": ISODate("2024-01-11T10:00:00Z")
}

{
  "_id": ObjectId("65a1b2c3d4e5f6789abcdef12"),
  "regNo": "STU002",
  "studentName": "Bob Williams",
  "status": "Absent",
  "subjectId": ObjectId("65a1b2c3d4e5f6789abcdef07"),
  "academicYearId": ObjectId("65a1b2c3d4e5f6789abcdef02"),
  "dateMarked": NumberLong(1704960000000),
  "markedBy": ObjectId("65a1b2c3d4e5f6789abcdef09"),
  "isSynced": false,
  "isOfflineCreated": true,
  "deviceInfo": {
    "deviceId": "android-device-uuid-456"
  },
  "createdAt": ISODate("2024-01-11T10:00:00Z"),
  "updatedAt": ISODate("2024-01-11T10:00:00Z")
}
```

## Indexes

### Performance Optimization Indexes

1. **Academic Years Collection**:
   - `{yearName: 1}` - Single field index for year name lookups
   - `{isActive: 1}` - Single field index for active status filtering

2. **Semester Types Collection**:
   - `{typeName: 1}` - Single field index for type name lookups

3. **Semesters Collection**:
   - `{semNumber: 1, semesterTypeId: 1}` - Compound index for semester queries
   - `{semesterTypeId: 1}` - Single field index for type-based queries
   - `{isActive: 1}` - Single field index for active status filtering

4. **Subjects Collection**:
   - `{semesterId: 1}` - Single field index for semester-based queries
   - `{subjectCode: 1}` - Single field index for code lookups
   - `{subjectName: 1}` - Single field index for name lookups

5. **Staff Collection**:
   - `{staffId: 1}` - Unique index for staff ID (critical for authentication)
   - `{email: 1}` - Unique index for email addresses
   - `{isActive: 1}` - Single field index for active status filtering
   - `{lastLogin: -1}` - Descending index for login history

6. **Attendance Collection**:
   - `{subjectId: 1, academicYearId: 1}` - Compound index for attendance reports
   - `{regNo: 1}` - Single field index for student lookups
   - `{dateMarked: -1}` - Descending index for chronological queries
   - `{isSynced: 1}` - Single field index for synchronization queries
   - `{markedBy: 1}` - Single field index for staff-based queries
   - `{isOfflineCreated: 1}` - Single field index for offline record queries

## Backend API Structure

### MongoDB Repository Layer (Server Side)

The backend Spring Boot application will use Spring Data MongoDB with the following repository interfaces:

1. **AcademicYearRepository**:
   - `findAll()` - Get all academic years
   - `findById(id)` - Get specific academic year
   - `findByIsActive(active)` - Get active/inactive years

2. **SemesterTypeRepository**:
   - `findAll()` - Get all semester types
   - `findById(id)` - Get specific semester type

3. **SemesterRepository**:
   - `findAll()` - Get all semesters
   - `findBySemesterTypeId(typeId)` - Get semesters by type
   - `findBySemesterTypeIdAndIsActive(typeId, isActive)` - Filter by type and status

4. **SubjectRepository**:
   - `findAll()` - Get all subjects
   - `findBySemesterId(semesterId)` - Get subjects by semester
   - `findBySubjectCode(subjectCode)` - Get subject by code

5. **StaffRepository**:
   - `findByStaffId(staffId)` - Get staff by ID
   - `findByEmail(email)` - Get staff by email
   - `findByStaffIdAndPassword(staffId, encodedPassword)` - Authenticate staff

6. **AttendanceRepository**:
   - `findAll()` - Get all attendance records
   - `findBySubjectIdAndAcademicYearId(subjectId, academicYearId)` - Get attendance for subject/year
   - `findByIsSynced(isSynced)` - Get synced/unsynced records
   - `findByRegNo(regNo)` - Get attendance for specific student
   - `findByMarkedBy(staffId)` - Get attendance marked by specific staff

## Android App Local Caching Strategy

### Local SQLite Database (Room) for Offline Support

Since MongoDB is a remote database, the Android app will implement a hybrid approach:

1. **Cache Collections**: Temporary local storage for offline functionality
2. **Sync Service**: Background service to synchronize with MongoDB
3. **Conflict Resolution**: Handle cases where remote data changes during offline period

### Local Cache Entity Structure

The local cache will use simplified versions of the remote documents:

1. **CachedAcademicYear**:
   - `id`: String (MongoDB ObjectId converted to string)
   - `yearName`: String
   - `isActive`: Boolean
   - `lastSyncTime`: Long

2. **CachedSemesterType**:
   - `id`: String (MongoDB ObjectId converted to string)
   - `typeName`: String
   - `lastSyncTime`: Long

3. **CachedSemester**:
   - `id`: String (MongoDB ObjectId converted to string)
   - `semNumber`: Int
   - `semesterTypeId`: String (foreign key reference)
   - `isActive`: Boolean
   - `lastSyncTime`: Long

4. **CachedSubject**:
   - `id`: String (MongoDB ObjectId converted to string)
   - `subjectName`: String
   - `subjectCode`: String
   - `semesterId`: String (foreign key reference)
   - `lastSyncTime`: Long

5. **CachedStaff**:
   - `id`: String (MongoDB ObjectId converted to string)
   - `staffId`: String
   - `name`: String
   - `email`: String
   - `password`: String (encrypted locally)
   - `lastLogin`: Long
   - `lastSyncTime`: Long

6. **LocalAttendance**:
   - `id`: String (MongoDB ObjectId converted to string)
   - `regNo`: String
   - `studentName`: String
   - `status`: String
   - `subjectId`: String (foreign key reference)
   - `academicYearId`: String (foreign key reference)
   - `dateMarked`: Long
   - `markedBy`: String (foreign key reference)
   - `isSynced`: Boolean
   - `isOfflineCreated`: Boolean
   - `localCreatedTime`: Long

## Synchronization Strategy

### Two-Way Sync Process

1. **Initial Sync**:
   - Download all academic hierarchy data on first login
   - Cache locally for offline access
   - Store MongoDB ObjectIds and sync timestamps

2. **Ongoing Sync**:
   - Upload locally created attendance records when online
   - Download remote changes periodically
   - Resolve conflicts based on timestamps and priority rules

3. **Sync Triggers**:
   - Manual sync button
   - Automatic sync when app comes to foreground
   - Scheduled sync during off-peak hours
   - Sync when network connectivity is restored

### Conflict Resolution Rules

1. **Attendance Conflicts**:
   - Server data takes precedence for existing records
   - Merge offline-created records with server data
   - Log conflicts for administrative review

2. **Timestamp-Based Resolution**:
   - Latest timestamp wins for field-level conflicts
   - Preserve user intent where possible
   - Notify users of resolved conflicts

## Security Considerations

### MongoDB Security
- **Authentication**: Secure user credentials with role-based access
- **Encryption**: Enable SSL/TLS for all connections
- **Network Isolation**: Configure firewall rules and IP whitelisting
- **Audit Logging**: Track database access and operations

### API Security
- **JWT Tokens**: Secure authentication for API access
- **Rate Limiting**: Prevent abuse of API endpoints
- **Input Validation**: Sanitize all inputs before database operations
- **API Keys**: Secure access to MongoDB from application servers

### Data Privacy
- **Field-Level Encryption**: Encrypt sensitive fields when possible
- **Access Controls**: Implement role-based access to different collections
- **Compliance**: Follow GDPR and other applicable privacy regulations

## Performance Optimization

### MongoDB Performance
- **Proper Indexing**: Implement suggested indexes for optimal query performance
- **Aggregation Pipelines**: Use for complex reporting queries
- **Sharding**: Consider for large-scale deployments
- **Monitoring**: Implement performance monitoring and alerts

### API Performance
- **Pagination**: Implement for large result sets
- **Caching**: Use Redis or similar for frequently accessed data
- **Compression**: Enable GZIP compression for API responses
- **Connection Pooling**: Optimize database connection management

## Migration Strategy

### From MySQL to MongoDB
- **Data Transformation**: Convert relational data to document structure
- **Migration Scripts**: Automated scripts for data transfer
- **Validation**: Verify data integrity after migration
- **Rollback Plan**: Prepare rollback procedures if needed

### Android App Integration
- **API Updates**: Update API endpoints to work with MongoDB
- **Sync Logic**: Implement synchronization between local cache and MongoDB
- **Testing**: Thorough testing of all functionality with new database
- **Performance Tuning**: Optimize queries and sync performance